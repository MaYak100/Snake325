<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f0f0;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .main-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .mode-btn {
            background: #ddd;
            color: #333;
        }

        .mode-btn.active {
            background: #4CAF50;
            color: white;
        }

        .clear-btn {
            background: #f44336;
            color: white;
        }

        .clear-btn:hover {
            background: #d32f2f;
        }

        .export-btn {
            background: #2196F3;
            color: white;
        }

        .export-btn:hover {
            background: #1976D2;
        }

        select, input {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            min-width: 150px;
        }

        #canvas {
            border: 2px solid #333;
            border-radius: 5px;
            cursor: crosshair;
            display: block;
            margin: 20px auto;
        }

        .output {
            margin-top: 20px;
        }

        textarea {
            width: 100%;
            height: 200px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            resize: vertical;
        }

        .info {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .stats {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        .structure-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .structure-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 3px;
            border: 1px solid #ddd;
        }

        .structure-info {
            flex-grow: 1;
        }

        .structure-level {
            background: #e0e0e0;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-right: 10px;
        }

        .format-selector {
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #ffeaa7;
        }

        .format-selector label {
            margin-right: 15px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ†Ô∏è –†–µ–¥–∞–∫—Ç–æ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π</h1>
        
        <div class="info">
            <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong> –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å" —É –ª—é–±–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Å –Ω—É–ª—è. 
            –õ–µ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –º—ã—à–∏ - –¥–æ–±–∞–≤–∏—Ç—å, –ø—Ä–∞–≤–∞—è - —É–±—Ä–∞—Ç—å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ.
        </div>

        <div class="format-selector">
            <label>–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞:</label>
            <input type="radio" name="format" value="array" id="formatArray" checked>
            <label for="formatArray">–ú–∞—Å—Å–∏–≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</label>
            <input type="radio" name="format" value="function" id="formatFunction">
            <label for="formatFunction">–§—É–Ω–∫—Ü–∏—è</label>
            <input type="radio" name="format" value="levelStructure" id="formatLevelStructure">
            <label for="formatLevelStructure">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —É—Ä–æ–≤–Ω—è</label>
        </div>

        <div class="main-controls">
            <div class="structure-list">
                <h3>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:</h3>
                <div id="structureItems"></div>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <label>–†–µ–∂–∏–º:</label>
                    <button class="mode-btn active" id="addMode">‚úèÔ∏è –î–æ–±–∞–≤–∏—Ç—å</button>
                    <button class="mode-btn" id="removeMode">üóëÔ∏è –£–±—Ä–∞—Ç—å</button>
                </div>
                
                <div class="control-group">
                    <label for="levelSelect">–£—Ä–æ–≤–µ–Ω—å:</label>
                    <select id="levelSelect">
                        <option value="1">1 - –ü—Ä–æ—Å—Ç–æ–π</option>
                        <option value="2">2 - –õ—ë–≥–∫–∏–π</option>
                        <option value="3">3 - –°—Ä–µ–¥–Ω–∏–π</option>
                        <option value="4">4 - –°–ª–æ–∂–Ω—ã–π</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="structureName">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="structureName" placeholder="structure1" value="">
                </div>

                <button class="clear-btn" id="clearBtn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                <button class="export-btn" id="exportBtn">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
            </div>
        </div>

        <canvas id="canvas" width="400" height="400"></canvas>

        <div class="stats">
            –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π —Ä–∞–∑–º–µ—â–µ–Ω–æ: <span id="obstacleCount">0</span> | 
            –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: <span id="currentStructure">–ù–æ–≤–∞—è</span>
        </div>

        <div class="output">
            <h3>–ö–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏:</h3>
            <textarea id="exportOutput" placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∫–æ–¥ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è..."></textarea>
        </div>
    </div>

    <script>
        // –°—Ç—Ä—É–∫—Ç—É—Ä—ã –∏–∑ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ index.html
        const levelStructures = {
            1: [
                [
                    {x:3,y:3}, {x:3,y:4}, {x:3,y:5}, {x:3,y:6}, {x:3,y:7}, {x:3,y:8}, {x:3,y:9}, {x:16,y:16},
                    {x:16,y:15}, {x:16,y:14}, {x:16,y:13}, {x:16,y:12}, {x:16,y:11}, {x:16,y:10}, {x:16,y:9}, {x:3,y:10},
                    {x:15,y:9}, {x:14,y:9}, {x:4,y:10}, {x:5,y:10}
                ],
                [
                    {x:6,y:3}, {x:7,y:3}, {x:8,y:3}, {x:9,y:3}, {x:10,y:3}, {x:11,y:3}, {x:12,y:3}, {x:5,y:3}, 
                    {x:14,y:3}, {x:13,y:3}, {x:5,y:4}, {x:6,y:4}, {x:7,y:4}, {x:8,y:4}, {x:9,y:4}, {x:10,y:4}, 
                    {x:11,y:4}, {x:12,y:4}, {x:13,y:4}, {x:14,y:4}, {x:5,y:16}, {x:6,y:16}, {x:7,y:16}, {x:8,y:16}, 
                    {x:9,y:16}, {x:10,y:16}, {x:11,y:16}, {x:12,y:16}, {x:13,y:16}, {x:14,y:16}, {x:14,y:15}, 
                    {x:13,y:15}, {x:12,y:15}, {x:11,y:15}, {x:10,y:15}, {x:9,y:15}, {x:8,y:15}, {x:7,y:15}, 
                    {x:6,y:15}, {x:5,y:15}
                ],
                [
                    {x:2,y:9}, {x:3,y:9}, {x:4,y:9}, {x:5,y:9}, {x:6,y:9}, {x:2,y:10}, {x:3,y:10}, {x:4,y:10}, 
                    {x:5,y:10}, {x:6,y:10}, {x:10,y:9}, {x:10,y:10}, {x:9,y:9}, {x:9,y:10}, {x:13,y:9}, {x:13,y:10}, 
                    {x:14,y:10}, {x:15,y:10}, {x:15,y:9}, {x:16,y:9}, {x:17,y:9}, {x:17,y:10}, {x:16,y:10}, {x:14,y:9}
                ]
            ],
            2: [
                [
                    {x:2,y:2}, {x:2,y:3}, {x:2,y:4}, {x:2,y:5}, {x:2,y:6}, {x:2,y:7}, {x:3,y:2}, {x:4,y:2}, 
                    {x:5,y:2}, {x:6,y:2}, {x:7,y:2}, {x:17,y:2}, {x:17,y:3}, {x:17,y:4}, {x:17,y:5}, {x:17,y:6}, 
                    {x:17,y:7}, {x:16,y:2}, {x:15,y:2}, {x:14,y:2}, {x:13,y:2}, {x:12,y:2}, {x:17,y:12}, {x:17,y:13}, 
                    {x:17,y:14}, {x:17,y:15}, {x:17,y:16}, {x:17,y:17}, {x:16,y:17}, {x:15,y:17}, {x:14,y:17}, 
                    {x:13,y:17}, {x:12,y:17}, {x:7,y:17}, {x:6,y:17}, {x:5,y:17}, {x:4,y:17}, {x:3,y:17}, {x:2,y:17}, 
                    {x:2,y:16}, {x:2,y:15}, {x:2,y:14}, {x:2,y:13}, {x:2,y:12}
                ],
                [
                    {x:4,y:1}, {x:5,y:1}, {x:12,y:0}, {x:13,y:0}, {x:14,y:0}, {x:15,y:0}, {x:0,y:19}, {x:1,y:19}, 
                    {x:2,y:19}, {x:3,y:19}, {x:9,y:18}, {x:10,y:18}, {x:11,y:18}, {x:12,y:18}, {x:17,y:17}, {x:18,y:17}, 
                    {x:19,y:17}, {x:3,y:1}, {x:2,y:1}, {x:19,y:5}, {x:18,y:5}, {x:17,y:5}, {x:16,y:5}, {x:10,y:6}, 
                    {x:9,y:6}, {x:8,y:6}, {x:7,y:6}, {x:6,y:6}, {x:1,y:7}, {x:0,y:7}, {x:2,y:13}, {x:3,y:13}, 
                    {x:4,y:13}, {x:13,y:11}, {x:14,y:11}, {x:15,y:11}, {x:16,y:11}
                ],
                [
                    {x:2,y:2}, {x:2,y:3}, {x:3,y:3}, {x:4,y:3}, {x:4,y:2}, {x:3,y:2}, {x:2,y:17}, {x:2,y:16}, 
                    {x:3,y:16}, {x:4,y:16}, {x:4,y:17}, {x:3,y:17}, {x:17,y:17}, {x:17,y:16}, {x:16,y:16}, {x:15,y:16}, 
                    {x:15,y:17}, {x:16,y:17}, {x:17,y:2}, {x:17,y:3}, {x:16,y:3}, {x:15,y:3}, {x:15,y:2}, {x:16,y:2}, 
                    {x:9,y:4}, {x:9,y:5}, {x:9,y:6}, {x:9,y:7}, {x:10,y:7}, {x:10,y:6}, {x:10,y:5}, {x:10,y:4}, 
                    {x:9,y:15}, {x:10,y:15}, {x:10,y:14}, {x:10,y:13}, {x:10,y:12}, {x:9,y:12}, {x:9,y:13}, {x:9,y:14}, 
                    {x:4,y:9}, {x:5,y:9}, {x:5,y:10}, {x:4,y:10}, {x:15,y:9}, {x:15,y:10}, {x:14,y:10}, {x:14,y:9}, 
                    {x:19,y:9}, {x:19,y:10}, {x:0,y:9}, {x:0,y:10}
                ]
            ],
            3: [
                [
                    {x:1,y:1}, {x:1,y:2}, {x:1,y:3}, {x:1,y:4}, {x:7,y:2}, {x:8,y:2}, {x:9,y:2}, {x:10,y:2}, 
                    {x:7,y:3}, {x:7,y:4}, {x:7,y:5}, {x:13,y:3}, {x:13,y:4}, {x:13,y:5}, {x:13,y:6}, {x:14,y:3}, 
                    {x:15,y:3}, {x:16,y:3}, {x:6,y:8}, {x:5,y:8}, {x:4,y:8}, {x:3,y:8}, {x:3,y:9}, {x:3,y:10}, 
                    {x:3,y:11}, {x:9,y:10}, {x:9,y:11}, {x:9,y:12}, {x:10,y:9}, {x:15,y:10}, {x:15,y:11}, {x:15,y:12}, 
                    {x:16,y:10}, {x:17,y:10}, {x:18,y:10}, {x:5,y:15}, {x:5,y:16}, {x:5,y:17}, {x:5,y:18}, {x:6,y:15}, 
                    {x:7,y:15}, {x:8,y:15}, {x:11,y:16}, {x:11,y:17}, {x:11,y:18}, {x:11,y:19}, {x:12,y:16}, {x:13,y:16}, 
                    {x:15,y:13}, {x:14,y:16}, {x:9,y:9}, {x:11,y:9}, {x:12,y:9}, {x:2,y:1}, {x:3,y:1}, {x:4,y:1}
                ],
                [
                    {x:17,y:2}, {x:17,y:3}, {x:17,y:4}, {x:12,y:2}, {x:16,y:2}, {x:15,y:2}, {x:11,y:2}, {x:11,y:3}, {x:11,y:4}, 
                    {x:14,y:2}, {x:13,y:2}, {x:8,y:2}, {x:8,y:3}, {x:8,y:4}, {x:7,y:2}, {x:6,y:2}, {x:2,y:3}, {x:5,y:2}, {x:4,y:2}, 
                    {x:3,y:2}, {x:2,y:2}, {x:2,y:4}, {x:6,y:8}, {x:6,y:7}, {x:7,y:7}, {x:8,y:7}, {x:9,y:7}, {x:10,y:7}, {x:11,y:7}, 
                    {x:12,y:7}, {x:13,y:7}, {x:13,y:8}, {x:13,y:9}, {x:6,y:9}, {x:11,y:12}, {x:11,y:13}, {x:11,y:14}, {x:12,y:12}, 
                    {x:13,y:12}, {x:14,y:12}, {x:15,y:12}, {x:16,y:12}, {x:17,y:12}, {x:17,y:13}, {x:17,y:14}, {x:8,y:12}, {x:8,y:13}, 
                    {x:8,y:14}, {x:7,y:12}, {x:6,y:12}, {x:5,y:12}, {x:4,y:12}, {x:3,y:12}, {x:2,y:12}, {x:2,y:13}, {x:2,y:14}, 
                    {x:17,y:7}, {x:18,y:7}, {x:19,y:7}, {x:2,y:7}, {x:1,y:7}, {x:0,y:7}, {x:3,y:9}, {x:3,y:8}, {x:3,y:7}, {x:16,y:7}, 
                    {x:16,y:8}, {x:16,y:9}, {x:6,y:17}, {x:6,y:18}, {x:7,y:18}, {x:8,y:18}, {x:9,y:18}, {x:10,y:18}, {x:11,y:18}, 
                    {x:12,y:18}, {x:13,y:18}, {x:13,y:17}
                ],
                [
                    {x:2,y:3}, {x:6,y:4}, {x:10,y:5}, {x:14,y:6}, {x:18,y:7}, {x:11,y:1}, {x:15,y:2}, {x:19,y:3}, {x:6,y:3}, {x:10,y:4}, {x:14,y:5}, 
                    {x:18,y:6}, {x:19,y:2}, {x:15,y:1}, {x:11,y:0}, {x:2,y:2}, {x:17,y:10}, {x:17,y:11}, {x:16,y:14}, {x:16,y:15}, {x:15,y:18}, 
                    {x:15,y:19}, {x:13,y:9}, {x:13,y:10}, {x:12,y:13}, {x:12,y:14}, {x:11,y:17}, {x:11,y:18}, {x:9,y:8}, {x:9,y:9}, {x:8,y:12}, 
                    {x:8,y:13}, {x:7,y:16}, {x:7,y:17}, {x:5,y:7}, {x:5,y:8}, {x:4,y:11}, {x:4,y:12}, {x:3,y:16}, {x:3,y:15}, {x:1,y:6}, {x:1,y:7}, 
                    {x:0,y:11}, {x:0,y:10}, {x:19,y:19}, {x:7,y:0}, {x:2,y:19}
                ]
            ],
            4: [
                [
                    {x:2,y:0}, {x:2,y:1}, {x:2,y:2}, {x:2,y:3}, {x:2,y:4}, {x:2,y:5}, {x:5,y:5}, {x:5,y:4}, 
                    {x:5,y:3}, {x:6,y:3}, {x:7,y:3}, {x:8,y:3}, {x:8,y:4}, {x:8,y:5}, {x:8,y:6}, {x:8,y:7}, 
                    {x:8,y:8}, {x:8,y:9}, {x:9,y:9}, {x:10,y:9}, {x:11,y:9}, {x:11,y:8}, {x:11,y:7}, {x:14,y:7}, 
                    {x:14,y:8}, {x:14,y:9}, {x:14,y:10}, {x:14,y:11}, {x:14,y:12}, {x:14,y:13}, {x:15,y:13}, 
                    {x:16,y:13}, {x:17,y:13}, {x:11,y:18}, {x:11,y:17}, {x:11,y:16}, {x:11,y:15}, {x:11,y:14}, 
                    {x:8,y:14}, {x:8,y:15}, {x:8,y:16}, {x:8,y:17}, {x:7,y:17}, {x:6,y:17}, {x:5,y:17}, {x:5,y:16}, 
                    {x:5,y:15}, {x:5,y:14}, {x:5,y:13}, {x:5,y:12}, {x:5,y:11}, {x:2,y:11}, {x:2,y:12}, {x:2,y:13}, 
                    {x:5,y:6}, {x:4,y:6}, {x:3,y:6}, {x:2,y:6}, {x:2,y:10}, {x:3,y:10}, {x:4,y:10}, {x:5,y:10}, 
                    {x:9,y:13}, {x:10,y:13}, {x:11,y:13}, {x:8,y:13}, {x:17,y:8}, {x:17,y:7}, {x:17,y:6}, {x:17,y:5}, 
                    {x:17,y:4}, {x:17,y:3}, {x:17,y:2}, {x:18,y:8}, {x:17,y:14}, {x:17,y:15}, {x:17,y:16}, {x:11,y:19}, 
                    {x:19,y:8}, {x:16,y:2}, {x:15,y:2}, {x:14,y:2}, {x:14,y:3}, {x:13,y:3}, {x:12,y:3}, {x:11,y:3}, 
                    {x:13,y:7}, {x:12,y:7}, {x:11,y:2}
                ],
                [
                    {x:17,y:0}, {x:17,y:1}, {x:17,y:2}, {x:17,y:3}, {x:17,y:4}, {x:17,y:6}, {x:17,y:7}, {x:17,y:8},
                    {x:17,y:9}, {x:17,y:10}, {x:17,y:12}, {x:17,y:13}, {x:17,y:14}, {x:17,y:15}, {x:17,y:16}, {x:17,y:18},
                    {x:17,y:19}, {x:14,y:19}, {x:14,y:18}, {x:14,y:17}, {x:14,y:16}, {x:14,y:15}, {x:14,y:13}, {x:14,y:12},
                    {x:14,y:11}, {x:14,y:10}, {x:14,y:9}, {x:14,y:7}, {x:14,y:6}, {x:14,y:5}, {x:14,y:4}, {x:14,y:3},
                    {x:14,y:1}, {x:14,y:0}, {x:11,y:0}, {x:11,y:1}, {x:11,y:2}, {x:11,y:3}, {x:11,y:4}, {x:11,y:6},
                    {x:11,y:7}, {x:11,y:8}, {x:11,y:9}, {x:11,y:10}, {x:11,y:12}, {x:11,y:13}, {x:11,y:14}, {x:11,y:15},
                    {x:11,y:16}, {x:11,y:18}, {x:11,y:19}, {x:8,y:19}, {x:8,y:18}, {x:8,y:17}, {x:8,y:16}, {x:8,y:15},
                    {x:8,y:13}, {x:8,y:12}, {x:8,y:11}, {x:8,y:10}, {x:8,y:9}, {x:8,y:7}, {x:8,y:6}, {x:8,y:5},
                    {x:8,y:4}, {x:8,y:3}, {x:8,y:1}, {x:8,y:0}, {x:5,y:0}, {x:5,y:1}, {x:5,y:2}, {x:5,y:3},
                    {x:5,y:4}, {x:5,y:6}, {x:5,y:7}, {x:5,y:8}, {x:5,y:9}, {x:5,y:10}, {x:5,y:12}, {x:5,y:13},
                    {x:5,y:14}, {x:5,y:15}, {x:5,y:16}, {x:5,y:18}, {x:5,y:19}, {x:2,y:19}, {x:2,y:18}, {x:2,y:17},
                    {x:2,y:16}, {x:2,y:15}, {x:2,y:13}, {x:2,y:12}, {x:2,y:11}, {x:2,y:10}, {x:2,y:9}, {x:2,y:7},
                    {x:2,y:6}, {x:2,y:5}, {x:2,y:4}, {x:2,y:3}, {x:2,y:1}, {x:2,y:0}
                ],
                [
                    {x:0,y:17}, {x:1,y:17}, {x:2,y:17}, {x:3,y:17}, {x:4,y:17}, {x:5,y:17}, {x:6,y:17}, {x:7,y:17}, 
                    {x:7,y:16}, {x:7,y:15}, {x:7,y:14}, {x:7,y:13}, {x:6,y:13}, {x:5,y:13}, {x:4,y:13}, {x:3,y:13}, 
                    {x:2,y:13}, {x:2,y:14}, {x:4,y:12}, {x:4,y:11}, {x:4,y:10}, {x:4,y:9}, {x:4,y:8}, {x:4,y:7}, 
                    {x:4,y:6}, {x:5,y:6}, {x:6,y:6}, {x:7,y:6}, {x:8,y:6}, {x:8,y:7}, {x:8,y:8}, {x:8,y:9}, 
                    {x:7,y:9}, {x:9,y:7}, {x:10,y:7}, {x:11,y:7}, {x:12,y:7}, {x:13,y:7}, {x:14,y:7}, {x:14,y:6}, 
                    {x:14,y:5}, {x:14,y:4}, {x:14,y:3}, {x:13,y:3}, {x:12,y:3}, {x:11,y:3}, {x:11,y:4}, {x:13,y:8}, 
                    {x:13,y:9}, {x:13,y:10}, {x:13,y:11}, {x:13,y:12}, {x:13,y:13}, {x:12,y:13}, {x:11,y:13}, {x:10,y:13}, 
                    {x:10,y:12}, {x:14,y:19}, {x:14,y:18}, {x:14,y:17}, {x:14,y:16}, {x:15,y:16}, {x:16,y:16}, {x:17,y:16}, 
                    {x:17,y:17}, {x:0,y:3}, {x:1,y:3}, {x:2,y:3}, {x:3,y:3}, {x:4,y:3}, {x:5,y:3}, {x:5,y:2}, 
                    {x:17,y:0}, {x:17,y:1}, {x:17,y:2}, {x:17,y:3}, {x:17,y:4}, {x:19,y:12}, {x:18,y:12}, {x:17,y:12}, 
                    {x:17,y:11}, {x:17,y:10}, {x:17,y:9}, {x:0,y:10}, {x:1,y:10}, {x:13,y:16}, {x:12,y:16}, {x:11,y:16}, 
                    {x:10,y:16}, {x:10,y:17}
                ]
            ]
        };

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const levelSelect = document.getElementById('levelSelect');
        const structureName = document.getElementById('structureName');
        const addModeBtn = document.getElementById('addMode');
        const removeModeBtn = document.getElementById('removeMode');
        const clearBtn = document.getElementById('clearBtn');
        const exportBtn = document.getElementById('exportBtn');
        const exportOutput = document.getElementById('exportOutput');
        const obstacleCount = document.getElementById('obstacleCount');
        const currentStructure = document.getElementById('currentStructure');
        const structureItems = document.getElementById('structureItems');

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        const gridSize = 20;
        const tileCount = canvas.width / gridSize;
        let obstacles = [];
        let isAddMode = true;
        let isMouseDown = false;
        let selectedStructureName = '';

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            drawGrid();
            updateObstacleCount();
            loadStructureList();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä
        function loadStructureList() {
            structureItems.innerHTML = '';
            
            Object.keys(levelStructures).forEach(level => {
                const structures = levelStructures[level];
                structures.forEach((structure, index) => {
                    const item = document.createElement('div');
                    item.className = 'structure-item';
                    item.innerHTML = `
                        <div class="structure-info">
                            <span class="structure-level">–£—Ä–æ–≤–µ–Ω—å ${level}</span>
                            <strong>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ ${index + 1}</strong>
                        </div>
                        <button onclick="window.selectStructure(${level}, ${index}, this)" style="background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                    `;
                    structureItems.appendChild(item);
                });
            });
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏ –∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
        function drawGrid() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –§–æ–Ω
            ctx.fillStyle = '#f5f5f5';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // –°–µ—Ç–∫–∞
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            
            for (let x = 0; x <= canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            for (let y = 0; y <= canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }

            // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            ctx.fillStyle = '#8e44ad';
            obstacles.forEach(obstacle => {
                ctx.fillRect(
                    obstacle.x * gridSize + 1, 
                    obstacle.y * gridSize + 1, 
                    gridSize - 2, 
                    gridSize - 2
                );
            });
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∫–ª–µ—Ç–∫–∏ –ø–æ –ø–æ–∑–∏—Ü–∏–∏ –º—ã—à–∏
        function getTileFromMouse(mouseX, mouseY) {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((mouseX - rect.left) / gridSize);
            const y = Math.floor((mouseY - rect.top) / gridSize);
            
            if (x >= 0 && x < tileCount && y >= 0 && y < tileCount) {
                return {x, y};
            }
            return null;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
        function addObstacle(x, y) {
            if (!obstacles.some(obs => obs.x === x && obs.y === y)) {
                obstacles.push({x, y});
                updateObstacleCount();
                drawGrid();
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
        function removeObstacle(x, y) {
            const index = obstacles.findIndex(obs => obs.x === x && obs.y === y);
            if (index !== -1) {
                obstacles.splice(index, 1);
                updateObstacleCount();
                drawGrid();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
        function updateObstacleCount() {
            obstacleCount.textContent = obstacles.length;
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤
        function setAddMode() {
            isAddMode = true;
            addModeBtn.classList.add('active');
            removeModeBtn.classList.remove('active');
            canvas.style.cursor = 'crosshair';
        }

        function setRemoveMode() {
            isAddMode = false;
            addModeBtn.classList.remove('active');
            removeModeBtn.classList.add('active');
            canvas.style.cursor = 'not-allowed';
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö
        function exportFunction() {
            const format = document.querySelector('input[name="format"]:checked').value;
            const name = structureName.value || 'structure1';
            const level = levelSelect.value;
            
            if (obstacles.length === 0) {
                exportOutput.value = '[]';
                return;
            }

            let output = '';
            
            switch (format) {
                case 'array':
                    // –ü—Ä–æ—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
                    output = obstacles.map(obs => `{x:${obs.x},y:${obs.y}}`).join(', ');
                    break;
                    
                case 'function':
                    // –§—É–Ω–∫—Ü–∏—è –≤ —Å—Ç–∞—Ä–æ–º —Å—Ç–∏–ª–µ
                    output = `function createLevel${level}Structure${name}() {\n    return [\n        `;
                    const lines = [];
                    let currentLine = [];
                    const maxLineLength = 8;
                    
                    obstacles.forEach((obs, index) => {
                        currentLine.push(`{x:${obs.x},y:${obs.y}}`);
                        if (currentLine.length === maxLineLength || index === obstacles.length - 1) {
                            lines.push(currentLine.join(', '));
                            currentLine = [];
                        }
                    });
                    
                    output += lines.join(',\n        ');
                    output += '\n    ];\n}';
                    break;
                    
                case 'levelStructure':
                    // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ levelStructures
                    output = `[\n        `;
                    const structureLines = [];
                    let currentStructureLine = [];
                    
                    obstacles.forEach((obs, index) => {
                        currentStructureLine.push(`{x:${obs.x},y:${obs.y}}`);
                        if (currentStructureLine.length === 8 || index === obstacles.length - 1) {
                            structureLines.push(currentStructureLine.join(', '));
                            currentStructureLine = [];
                        }
                    });
                    
                    output += structureLines.join(',\n        ');
                    output += '\n    ]';
                    break;
            }
            
            exportOutput.value = output;
            exportOutput.select();
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
        function clearAll() {
            if (obstacles.length > 0 && confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è?')) {
                obstacles = [];
                selectedStructureName = '';
                currentStructure.textContent = '–ù–æ–≤–∞—è';
                structureName.value = '';
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                const items = document.querySelectorAll('.structure-item');
                items.forEach(item => {
                    item.style.border = '1px solid #ddd';
                    item.style.background = 'white';
                });
                
                updateObstacleCount();
                drawGrid();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –º—ã—à–∏
        canvas.addEventListener('mousedown', (e) => {
            isMouseDown = true;
            const tile = getTileFromMouse(e.clientX, e.clientY);
            if (tile) {
                if (e.button === 0) { // –õ–µ–≤–∞—è –∫–Ω–æ–ø–∫–∞
                    if (isAddMode) {
                        addObstacle(tile.x, tile.y);
                    } else {
                        removeObstacle(tile.x, tile.y);
                    }
                } else if (e.button === 2) { // –ü—Ä–∞–≤–∞—è –∫–Ω–æ–ø–∫–∞
                    removeObstacle(tile.x, tile.y);
                }
            }
            e.preventDefault();
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isMouseDown) {
                const tile = getTileFromMouse(e.clientX, e.clientY);
                if (tile) {
                    if (isAddMode) {
                        addObstacle(tile.x, tile.y);
                    } else {
                        removeObstacle(tile.x, tile.y);
                    }
                }
            }
        });

        canvas.addEventListener('mouseup', () => {
            isMouseDown = false;
        });

        // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
        canvas.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        addModeBtn.addEventListener('click', setAddMode);
        removeModeBtn.addEventListener('click', setRemoveMode);
        clearBtn.addEventListener('click', clearAll);
        exportBtn.addEventListener('click', exportFunction);

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä
        window.selectStructure = function(level, index, buttonElement) {
            try {
                const structure = levelStructures[level][index];
                obstacles = structure.slice();
                
                // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
                const items = document.querySelectorAll('.structure-item');
                items.forEach(item => {
                    item.style.border = '1px solid #ddd';
                    item.style.background = 'white';
                });
                
                // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
                const structureItem = buttonElement.closest('.structure-item');
                if (structureItem) {
                    structureItem.style.border = '2px solid #4CAF50';
                    structureItem.style.background = '#f0f8ff';
                }
                
                levelSelect.value = level;
                structureName.value = `structure${index + 1}`;
                currentStructure.textContent = `–£—Ä–æ–≤–µ–Ω—å ${level}, –°—Ç—Ä—É–∫—Ç—É—Ä–∞ ${index + 1}`;
                
                updateObstacleCount();
                drawGrid();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: ' + error.message);
            }
        };

        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', (e) => {
            if (e.key === '1') setAddMode();
            if (e.key === '2') setRemoveMode();
            if (e.key === 'Backspace') clearAll();
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                exportFunction();
            }
        });

        // –ó–∞–ø—É—Å–∫
        init();
    </script>
</body>
</html>
